<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Emoji en el título de la pestaña -->
    <title>🐷 UEB Leopoldo Reyes - Estimador Peso Cerdos (Libras)</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      // Tailwind Configuration
      tailwind.config = {
        theme: {
          extend: {
            fontFamily: {
              sans: ['Roboto', 'sans-serif'],
            },
            colors: {
              primary: {
                DEFAULT: '#16a34a',
                light: '#22c55e',
                dark: '#15803d',
              },
              secondary: '#10b981',
              danger: {
                  light: '#fecaca',
                  DEFAULT: '#b91c1c',
                  border: '#f87171'
              },
              neutral: {
                  light: '#f3f4f6',
                  medium: '#6b7280',
                  dark: '#1f2937'
              }
            }
          }
        }
      }
    </script>
    <style>
        /* Estilos CSS */
        input[type=number]::-webkit-inner-spin-button,
        input[type=number]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        input[type=number] { -moz-appearance: textfield; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        input[aria-invalid="true"], select[aria-invalid="true"] { border-color: #f87171; box-shadow: 0 0 0 1px #f87171; }
        select option:first-child { color: #9ca3af; }
        select:invalid { color: #9ca3af; }
        body { font-family: 'Roboto', sans-serif; }
    </style>
</head>
<body class="bg-neutral-light font-sans flex items-center justify-center min-h-screen p-4">

    <div class="bg-white rounded-xl shadow-xl w-full max-w-lg overflow-hidden">
        <header class="bg-primary text-white p-6 text-center">
             <h1 class="text-2xl font-semibold mb-1">
                 <!-- Emojis en el título principal -->
                 🐷 Estimador de Peso Porcino ⚖️
             </h1>
            <p class="text-sm opacity-90">📍 UEB Leopoldo Reyes</p>
        </header>

        <div class="p-6 md:p-8">
            <div class="bg-green-50 border border-green-200 text-green-800 p-4 rounded-md mb-6 text-sm">
                 <!-- Emoji en la nota informativa -->
                 💡 Estima la ganancia de peso (en libras) basada en el pienso por consumir (kg),
                 el <strong>FCA de la etapa</strong> y un <strong>desperdicio opcional</strong>. Resultados aproximados.
            </div>

            <form id="calculation-form" novalidate class="space-y-5">
                <div>
                    <label for="etapaCerdo" class="block text-sm font-medium text-neutral-medium mb-1">
                        <!-- Emoji en la etiqueta -->
                        🌱 Etapa de los Cerdos (selecciona una):
                    </label>
                    <select id="etapaCerdo" name="etapaCerdo" required
                            class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-light focus:border-primary-light transition duration-150 ease-in-out bg-white invalid:text-neutral-medium">
                        <option value="" disabled selected hidden>-- 👇 Elige la etapa --</option>
                        <!-- Emojis en las opciones -->
                        <option value="1.6">👶 Pre-inicio / Lechón (&lt;15kg / &lt;33 lbs) - FCA: 1.6</option>
                        <option value="2.2">🐖 Inicio (15-30kg / 33-66 lbs) - FCA: 2.2</option>
                        <option value="2.8">💪 Crecimiento (30-60kg / 66-132 lbs) - FCA: 2.8</option>
                        <option value="3.3">🏆 Finalización / Engorde (60kg+ / 132 lbs+) - FCA: 3.3</option>
                        <option value="3.0">🔄 Promedio Ciclo Completo - FCA: 3.0</option>
                    </select>
                </div>

                <div>
                    <label for="numCerdos" class="block text-sm font-medium text-neutral-medium mb-1">
                         <!-- Emoji en la etiqueta -->
                         🔢 Número de Cerdos:
                    </label>
                    <!-- Campo de número de cerdos sin valor por defecto -->
                    <input type="number" id="numCerdos" name="numCerdos" min="1" required inputmode="numeric" placeholder="Ej: 10"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-light focus:border-primary-light transition duration-150 ease-in-out">
                </div>

                <div>
                    <label for="pesoInicialPromedio" class="block text-sm font-medium text-neutral-medium mb-1">
                         <!-- Emoji en la etiqueta -->
                         ⚖️ Peso Actual Promedio por Cerdo (libras):
                    </label>
                    <input type="number" id="pesoInicialPromedio" name="pesoInicialPromedio" min="0" step="0.1" placeholder="Ej: 56.2 lbs" required inputmode="decimal"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-light focus:border-primary-light transition duration-150 ease-in-out">
                </div>

                <div>
                    <label for="kilosPiensoPorConsumir" class="block text-sm font-medium text-neutral-medium mb-1">
                         <!-- Emoji en la etiqueta -->
                         🌾 Cantidad Total Pienso por Consumir (kg):
                    </label>
                    <input type="number" id="kilosPiensoPorConsumir" name="kilosPiensoPorConsumir" min="0" step="0.1" placeholder="Ej: 1500.5 kg" required inputmode="decimal"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-light focus:border-primary-light transition duration-150 ease-in-out">
                </div>

                <div>
                    <label for="porcentajeDesperdicio" class="block text-sm font-medium text-neutral-medium mb-1">
                         <!-- Emoji en la etiqueta -->
                         🗑️ Desperdicio Estimado de Pienso (% - Opcional):
                    </label>
                    <input type="number" id="porcentajeDesperdicio" name="porcentajeDesperdicio" min="0" max="100" step="0.1" placeholder="Ej: 5 % (dejar vacío si no aplica)" inputmode="decimal"
                           class="w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-primary-light focus:border-primary-light transition duration-150 ease-in-out">
                </div>

                <div class="flex flex-col sm:flex-row gap-3 mt-6">
                     <button type="submit" id="calcularBtn"
                             class="w-full sm:w-2/3 bg-primary text-white font-semibold py-3 px-4 rounded-md shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-light active:bg-primary-dark active:shadow-inner active:scale-[0.98] transition duration-150 ease-in-out">
                         <!-- Emojis en el botón -->
                         📊 Estimar Ganancia y Peso Final
                     </button>
                     <button type="reset" id="resetBtn"
                             class="w-full sm:w-1/3 bg-neutral-medium/80 hover:bg-neutral-medium text-white font-semibold py-3 px-4 rounded-md shadow-md hover:shadow-lg focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-neutral-dark active:bg-neutral-dark active:shadow-inner active:scale-[0.98] transition duration-150 ease-in-out">
                         <!-- Emoji en el botón (CAMBIADO) -->
                          ♻️ Limpiar
                     </button>
                </div>
            </form>

            <!-- Contenedor de mensaje de error -->
            <div id="errorMensaje" role="alert" aria-live="assertive"
                 class="bg-danger-light border border-danger-border text-danger-DEFAULT px-4 py-3 rounded-md mt-6 text-sm font-medium hidden">
                 <!-- Emoji en el mensaje de error -->
                 <span class="mr-2">⚠️</span><span id="errorTexto"></span>
            </div>

            <div id="resultados" class="mt-8 border-t border-gray-200 pt-6 hidden fade-in">
                <h2 class="text-xl font-semibold text-neutral-dark mb-4 text-center">
                     <!-- Emojis en el título de resultados -->
                     📊 Resultados Estimados 🎉
                </h2>

                <div class="space-y-3 text-sm">
                     <div class="flex justify-between items-center bg-gray-50 p-3 rounded-md">
                          <span class="text-neutral-medium">⚖️ Peso Actual Promedio:</span>
                          <strong id="resultadoPesoInicial" class="text-neutral-dark font-medium">-- lbs</strong>
                     </div>
                     <div class="flex justify-between items-center p-2">
                          <span class="text-neutral-medium">🌱 Etapa / FCA Utilizado:</span>
                          <strong id="fcaUtilizadoResultado" class="text-neutral-dark font-medium">--</strong>
                     </div>
                     <div class="flex justify-between items-center p-2">
                          <span class="text-neutral-medium">🗑️ Desperdicio Asumido:</span>
                          <strong id="resultadoDesperdicio" class="text-neutral-dark font-medium">-- %</strong>
                     </div>

                     <hr class="my-2 border-gray-100">

                     <div class="flex justify-between items-center p-2">
                          <span class="text-neutral-medium">➕📈 Ganancia Total Estimada:</span>
                          <strong id="pesoTotal" class="text-secondary font-semibold text-base">-- lbs</strong>
                     </div>
                     <div class="flex justify-between items-center p-2">
                          <span class="text-neutral-medium">➕🐖 Ganancia Promedio / Cerdo:</span>
                          <strong id="pesoPromedio" class="text-secondary font-semibold text-base">-- lbs</strong>
                     </div>
                     <div class="flex justify-between items-center p-3 bg-green-50 rounded-md mt-2">
                          <span class="font-medium text-green-800">✅🏁 Peso Final Promedio / Cerdo:</span>
                          <strong id="pesoFinalPromedio" class="text-green-700 font-bold text-lg">-- lbs</strong>
                     </div>
                </div>

                <p class="mt-6 text-xs text-neutral-medium text-center italic">
                     <!-- Emoji en la nota final -->
                     ℹ️ Nota: La ganancia real dependerá del FCA real, desperdicio y condiciones específicas.
                </p>
            </div>

        </div>
    </div>

    <!-- Script JavaScript -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- Referencias a Elementos del DOM ---
            const form = document.getElementById('calculation-form');
            const etapaCerdoSelect = document.getElementById('etapaCerdo');
            const numCerdosInput = document.getElementById('numCerdos');
            const pesoInicialPromedioInput = document.getElementById('pesoInicialPromedio');
            const kilosPiensoPorConsumirInput = document.getElementById('kilosPiensoPorConsumir');
            const desperdicioInput = document.getElementById('porcentajeDesperdicio');
            const allInputs = [etapaCerdoSelect, numCerdosInput, pesoInicialPromedioInput, kilosPiensoPorConsumirInput, desperdicioInput];

            // Elementos de Visualización de Resultados y Errores
            const resultadosDiv = document.getElementById('resultados');
            const pesoTotalSpan = document.getElementById('pesoTotal');
            const pesoPromedioSpan = document.getElementById('pesoPromedio');
            const resultadoPesoInicialSpan = document.getElementById('resultadoPesoInicial');
            const pesoFinalPromedioSpan = document.getElementById('pesoFinalPromedio');
            const fcaUtilizadoResultadoSpan = document.getElementById('fcaUtilizadoResultado');
            const resultadoDesperdicioSpan = document.getElementById('resultadoDesperdicio');
            const errorMensajeDiv = document.getElementById('errorMensaje');
            const errorTextoSpan = document.getElementById('errorTexto');

            // --- Constantes ---
            const KG_TO_LBS = 2.20462; // Factor de conversión kg a lbs

            // --- Funciones Utilitarias ---

            function mostrarError(mensaje, inputConError = null) {
                errorTextoSpan.textContent = mensaje;
                errorMensajeDiv.classList.remove('hidden');
                resultadosDiv.classList.add('hidden');
                if (inputConError) {
                    inputConError.focus();
                    inputConError.classList.add('border-danger-border', 'ring-1', 'ring-danger-border');
                    inputConError.setAttribute('aria-invalid', 'true');
                    inputConError.setAttribute('aria-describedby', 'errorMensaje');
                }
            }

             function ocultarErrorYResultados() {
                 errorMensajeDiv.classList.add('hidden');
                 errorTextoSpan.textContent = '';
                 resultadosDiv.classList.add('hidden');
                 allInputs.forEach(input => {
                     input.classList.remove('border-danger-border', 'ring-1', 'ring-danger-border');
                     input.removeAttribute('aria-invalid');
                     input.removeAttribute('aria-describedby');
                      if(input.tagName.toLowerCase() === 'select') {
                           input.classList.remove('invalid:text-neutral-medium');
                      }
                 });
             }


            function validarInputs() {
                ocultarErrorYResultados();
                let isValid = true;
                let firstErrorInput = null;
                let firstErrorMessage = '';

                const inputsToValidate = [
                    { input: etapaCerdoSelect, name: 'Etapa de los Cerdos', isSelect: true, required: true },
                    { input: numCerdosInput, name: 'Número de Cerdos', min: 1, allowZero: false, required: true }, // Validar que sea > 0
                    { input: pesoInicialPromedioInput, name: 'Peso Actual Promedio', unit: 'libras', min: 0, allowZero: true, required: true },
                    { input: kilosPiensoPorConsumirInput, name: 'Cantidad Total Pienso', unit: 'kg', min: 0, allowZero: true, required: true },
                    { input: desperdicioInput, name: 'Desperdicio Estimado', unit: '%', min: 0, max: 100, allowZero: true, required: false }
                ];

                for (const item of inputsToValidate) {
                    const inputElement = item.input;
                    const value = inputElement.value.trim();
                    let currentInputIsValid = true;
                    let errorMessage = '';
                    const nameWithUnit = item.unit ? `${item.name} (${item.unit})` : item.name;


                    if (item.required && value === '') {
                        errorMessage = item.isSelect
                            ? `Por favor, selecciona la ${item.name.toLowerCase()} 👇.`
                            : `Por favor, introduce el ${nameWithUnit.toLowerCase()} 📝.`;
                        currentInputIsValid = false;
                    }
                    else if (value !== '') {
                        if (item.isSelect) {
                           // Valid select
                        } else { // Numeric inputs
                            const parsedValue = parseFloat(value);
                            if (isNaN(parsedValue)) {
                                errorMessage = `El valor para ${nameWithUnit.toLowerCase()} debe ser numérico 🤔.`;
                                currentInputIsValid = false;
                             } else if (item.min === 1 && parsedValue <= 0) { // Specifically for Num Cerdos
                                 errorMessage = `El ${nameWithUnit.toLowerCase()} debe ser un valor positivo (mayor que 0) 👍.`;
                                 currentInputIsValid = false;
                             } else if (item.min !== undefined && parsedValue < item.min) {
                                errorMessage = `El ${nameWithUnit.toLowerCase()} debe ser ${item.min} o mayor ⬆️.`;
                                currentInputIsValid = false;
                            } else if (item.max !== undefined && parsedValue > item.max) {
                                 errorMessage = `El ${nameWithUnit.toLowerCase()} debe ser ${item.max} o menor ⬇️.`;
                                 currentInputIsValid = false;
                            }
                        }
                    }

                    if (!currentInputIsValid) {
                        isValid = false;
                        if (!firstErrorInput) {
                            firstErrorInput = inputElement;
                            firstErrorMessage = errorMessage;
                        }
                    }
                }

                if (!isValid) {
                    mostrarError(firstErrorMessage, firstErrorInput);
                }

                return isValid;
            }

            function calcularYMostrarResultados() {
                console.log("Calculando resultados... ⚙️");

                // --- Get Input Values ---
                const fcaSeleccionado = parseFloat(etapaCerdoSelect.value);
                const etapaSeleccionadaTexto = etapaCerdoSelect.options[etapaCerdoSelect.selectedIndex].text;
                const numCerdos = parseInt(numCerdosInput.value, 10); // Will parse the entered value
                const pesoInicialPromedioLbs = parseFloat(pesoInicialPromedioInput.value);
                const kilosPiensoAconsumir = parseFloat(kilosPiensoPorConsumirInput.value);

                // --- Process Optional Waste ---
                let porcentajeDesperdicio = parseFloat(desperdicioInput.value);
                if (isNaN(porcentajeDesperdicio) || porcentajeDesperdicio < 0) {
                    porcentajeDesperdicio = 0;
                }
                porcentajeDesperdicio = Math.min(porcentajeDesperdicio, 100);
                console.log(`Desperdicio aplicado: ${porcentajeDesperdicio}% 🗑️`);

                 // --- Additional Safety Validations (already covered by validarInputs, but good practice) ---
                 if (numCerdos <= 0) {
                     mostrarError("El número de cerdos debe ser mayor que cero. 🔢", numCerdosInput);
                     return;
                 }
                 if (isNaN(fcaSeleccionado) || fcaSeleccionado <= 0) {
                      mostrarError("El Factor de Conversión Alimenticia (FCA) seleccionado no es válido. 🌱", etapaCerdoSelect);
                      return;
                 }
                 console.log(`FCA: ${fcaSeleccionado}, Cerdos: ${numCerdos}, Peso Inicial: ${pesoInicialPromedioLbs} lbs, Pienso Total: ${kilosPiensoAconsumir} kg`);

                // --- Core Calculations ---
                const kilosPiensoEfectivo = kilosPiensoAconsumir * (1 - (porcentajeDesperdicio / 100));
                const gananciaTotalEstimadaKg = kilosPiensoEfectivo / fcaSeleccionado;
                const gananciaTotalEstimadaLbs = gananciaTotalEstimadaKg * KG_TO_LBS;
                const gananciaPromedioEstimadaLbs = gananciaTotalEstimadaLbs / numCerdos;
                const pesoFinalPromedioEstimadoLbs = pesoInicialPromedioLbs + gananciaPromedioEstimadaLbs;
                console.log(`Pienso Efectivo: ${kilosPiensoEfectivo.toFixed(2)} kg 🌾`);
                console.log(`Ganancia Total Estimada: ${gananciaTotalEstimadaKg.toFixed(2)} kg -> ${gananciaTotalEstimadaLbs.toFixed(2)} lbs 📈`);
                console.log(`Ganancia Promedio / Cerdo: ${gananciaPromedioEstimadaLbs.toFixed(2)} lbs 🐖`);
                console.log(`Peso Final Promedio / Cerdo: ${pesoFinalPromedioEstimadoLbs.toFixed(1)} lbs ✅`);

                // --- Display Results ---
                resultadoPesoInicialSpan.textContent = `${pesoInicialPromedioLbs.toFixed(1)} lbs`;
                let nombreEtapa = etapaSeleccionadaTexto.split('- FCA:')[0].trim();
                const primerCaracter = nombreEtapa.codePointAt(0);
                 if (primerCaracter >= 0x1F300 && primerCaracter <= 0x1FAFF) { // Simplistic emoji check
                     nombreEtapa = nombreEtapa.substring(nombreEtapa.indexOf(' ') + 1).trim();
                 }
                fcaUtilizadoResultadoSpan.textContent = `${nombreEtapa} (FCA: ${fcaSeleccionado.toFixed(2)})`;
                resultadoDesperdicioSpan.textContent = `${porcentajeDesperdicio.toFixed(1)} %`;
                pesoTotalSpan.textContent = `${gananciaTotalEstimadaLbs.toFixed(2)} lbs`;
                pesoPromedioSpan.textContent = `${gananciaPromedioEstimadaLbs.toFixed(2)} lbs`;
                pesoFinalPromedioSpan.textContent = `${pesoFinalPromedioEstimadoLbs.toFixed(1)} lbs`;

                // --- Animate Results ---
                resultadosDiv.classList.remove('hidden');
                void resultadosDiv.offsetWidth;
                resultadosDiv.classList.add('fade-in');
                setTimeout(() => {
                    resultadosDiv.classList.remove('fade-in');
                }, 500);
            }

            // --- Event Listeners ---
            form.addEventListener('submit', (event) => {
                event.preventDefault();
                console.log("Formulario enviado, validando... ✅");
                if (validarInputs()) {
                    calcularYMostrarResultados();
                } else {
                     console.log("Validación fallida. ❌");
                }
            });

            form.addEventListener('reset', () => {
                 console.log("Formulario reseteado. ♻️"); // Updated emoji
                 ocultarErrorYResultados();
                 etapaCerdoSelect.classList.add('invalid:text-neutral-medium');
            });

            allInputs.forEach(input => {
                 const eventType = input.tagName === 'SELECT' ? 'change' : 'input';
                 input.addEventListener(eventType, () => {
                     if (!errorMensajeDiv.classList.contains('hidden') || !resultadosDiv.classList.contains('hidden')) {
                          ocultarErrorYResultados();
                     }
                     input.classList.remove('border-danger-border', 'ring-1', 'ring-danger-border');
                     input.removeAttribute('aria-invalid');
                     input.removeAttribute('aria-describedby');
                      if(input.tagName === 'SELECT') {
                           input.classList.add('invalid:text-neutral-medium');
                      }
                 });
            });
        });
    </script>

</body>
</html>
